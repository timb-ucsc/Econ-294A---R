---
title: "Final Exam"
author: "Tim Boudreau"
date: "March 15, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache=TRUE)
```

```{r package-load, message=FALSE, warning = FALSE}
library(nycflights13)
library(RSQLite)
library(dplyr)
library(ggplot2)
```

Use the NYC Flight data from 2013:

```{r, echo = F, message = FALSE}
my.data <- nycflights13_sqlite()

flights <- tbl(my.data, "flights") %>% 
    collect() %>%
    mutate(canceled = is.na(arr_time))
weather <- tbl(my.data, "weather") %>% collect()
airlines <- tbl(my.data, "airlines") %>% collect()
airports <- tbl(my.data, "airports") %>% collect()
planes <- tbl(my.data, "planes") %>% collect()

flights$canceled <- flights$canceled + 0
flights$date <- paste( flights$year, flights$month, flights$day, sep = ".")
weather$date <- paste( weather$year, weather$month, weather$day, sep = ".")
```

## Create a data frame for weather data and flight delays and cancelations by collapsing flights and weather by day into relevant staistics and merging the collapsed data frame.

```{r}
flights.w <- flights %>%
  group_by(date) %>%
  summarise(
    delay <- mean(dep_delay, na.rm = T),
    cancel <- sum(canceled)
  )

weather.w <- weather %>%
  group_by(date) %>%
  summarise(
    temperature <- mean(temp, na.rm = T),
    dew <- mean(dewp, na.rm = T),
    humidity <- mean(humid, na.rm = T),
    wind_direction <- mean(wind_dir, na.rm = T),
    wind_mph <- mean(wind_speed, na.rm = T),
    wind_gusts <- mean(wind_gust, na.rm = T),
    rain <- mean(precip, na.rm = T),
    pressu <- mean(pressure, na.rm = T),
    visibility <- mean(visib, na.rm = T)
  )

data.fw <- inner_join(flights.w, weather.w, by = c("date"))
```

## Create a data frame for airport and flight delays and cancelations by merging a daily collapsed flight data frame with airport data.

```{r}
flights.ap <- flights %>%
  group_by(date, dest) %>%
  summarise(
    delay <- mean(dep_delay, na.rm = T),
    cancel <- sum(canceled)
  ) 

airports.ap <- airports[,1:2]

data.ap <- inner_join(flights.ap, airports.ap, by = c("dest" = "faa"))
```

## Create a data frame for plane characteristics and flight delays and cancelations by collapsing flight data and merging.

```{r}
flights.p <- flights %>%
  group_by(date, tailnum) %>%
  summarise(
    delay <- mean(dep_delay, na.rm = T),
    cancel <- sum(canceled)
  ) 

data.p <- inner_join(flights.p, planes, by = c("tailnum"))
```


